<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Theory · SixDOF.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>SixDOF.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../guide/">Guide</a></li><li class="current"><a class="toctext" href>Theory</a><ul class="internal"><li><a class="toctext" href="#Introduction-1">Introduction</a></li><li><a class="toctext" href="#State-and-Coordinate-Systems-1">State and Coordinate Systems</a></li><li><a class="toctext" href="#Kinematics-and-Dynamics-1">Kinematics and Dynamics</a></li><li><a class="toctext" href="#Forces/Moments-1">Forces/Moments</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Theory</a></li></ul><a class="edit-page" href="https://github.com/byuflowlab/SixDOF.jl/blob/master/docs/src/theory.md#L"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Theory</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Theory-1" href="#Theory-1">Theory</a></h1><h2><a class="nav-anchor" id="Introduction-1" href="#Introduction-1">Introduction</a></h2><p>This nonlinear sixDOF model uses aircraft conventions as that is our target application.  Although the model is fairly general, some extensions may be needed for other applications (derivatives of moment of inertia tensor for morphing aircraft, quaternions and gravitational moments for spacecraft).</p><h2><a class="nav-anchor" id="State-and-Coordinate-Systems-1" href="#State-and-Coordinate-Systems-1">State and Coordinate Systems</a></h2><p>Two main coordinate systems are used in this analysis as depicted below.  The first is the inertial frame <span>$(x_i, y_i, z_i)$</span>, fixed to the ground <a href="#footnote-1">[1]</a>, centered at some arbitrary reference point (sometimes this coordinate system is referred to as north-east-down).  The second is the body frame <span>$(x_b, y_b, z_b)$</span>, fixed to the moving and rotating vehicle, centered at the vehicle&#39;s center of mass.  A third coordinate system will be introduced later in connection with aerodynamics.</p><p><img src="../cs.png" alt="coordinate systems"/></p><p>The aircraft has 12 state variables: the linear and angular positions and the linear and angular velocities.  </p><div>\[s = [x, y, z, \phi, \theta, \psi, u, v, w, p, q, r]^T\]</div><p>The positions are defined in the inertial frame, while the velocities are defined in the body frame.  The rotational velocities <span>$p, q, r$</span> correspond to roll, pitch, and yaw rates respectively.  </p><p>Although there are twelve state variables, there are only six indepedent degrees of freedom (hence the name SixDOF).  The other six constraints are purely kinematic relationships enforcing consistency between positions and velocities.</p><p>We define the angular orientation of the vehicle using Euler angles.  Euler angles are not unique. We use a typical representation with the following order from the inertial axis to the body axis:</p><ol><li>rotate <span>$\psi$</span> radians about the inertial z-axis</li><li>rotate <span>$\theta$</span> radians about the new y-axis</li><li>rotate <span>$\phi$</span> radians about the new x-axis.</li></ol><p>The resulting rotations will then align with the body axis.  The two coordinate systems will generally still differ by a translation.  For the calculations here, like transfering velocity vectors between the frames, the translation offset is irrelevant.</p><p>The resulting rotation matrix from inertial to body is (see Beard and McLain for derivation <a href="#footnote-2">[2]</a>:</p><div>\[R_{i \rightarrow b} = 
\begin{bmatrix}
\cos\theta\cos\psi &amp; \cos\theta\sin\psi &amp; -\sin\theta \\
\sin\phi\sin\theta\cos\psi - \cos\phi\sin\psi &amp; \sin\phi\sin\theta\sin\psi + \cos\phi\cos\psi &amp; \sin\phi\cos\theta \\
\cos\phi\sin\theta\cos\psi + \sin\phi\sin\psi &amp; \cos\phi\sin\theta\sin\psi - \sin\phi\cos\psi &amp; \cos\phi\cos\theta
\end{bmatrix}\]</div><p>This matrix is orthogonal so its inverse is its transpose.  In other words the rotation matrix from body to inertial is the transpose of above:</p><div>\[R_{b \rightarrow i} = R_{i \rightarrow b}^T\]</div><p>The downside of Euler angles is that there is a singularity.  For this particular order that singularity occurs at a <span>$\theta$</span> (associated with pitch) of <span>$\pm 90^\circ$</span>.  At that state, the yaw angle is not unique, a phenomenon known as gimbal lock.  The avoid this issue, quaternions are commonly used.  For spacecraft such pitch angles would be normal and thus this would be an important consideration.  For now, we are only simulating aircraft so the simplicity of Euler angles is justified.</p><h2><a class="nav-anchor" id="Kinematics-and-Dynamics-1" href="#Kinematics-and-Dynamics-1">Kinematics and Dynamics</a></h2><p>We now need to compute derivatives of all state variables in order to formulate an ODE.</p><p>The first two relationships are simply kinematic relationships between positions and velocities.  The derivative of the vehicle&#39;s position (<span>$\vec{r_i} = [x, y, z]^T$</span>) is just the vehicle&#39;s velocity (<span>$\vec{V_b} = [u, v, w]^T$</span>).  However, position is defined in the inertial frame, whereas the velocity is given in the body frame.  Thus, a rotation matrix is needed.</p><div>\[\frac{d \vec{r_i}}{dt} = R_{b \rightarrow i} \vec{V_b}\]</div><p>Next, we need the derivatives of the Euler angles.  The procedure is the same as above, except that the Euler angles are defined across four different coordinate systems consisting of the body frame, inertial frame, and two intermediate frames between those two (see above definition of Euler angles).  The details are just coordinate transformations, but are a bit tedious and so are not repeated here (see <a href="#footnote-2">[2]</a> for derivation).  The result is:</p><div>\[\begin{bmatrix}
\dot{\phi} \\
\dot{\theta} \\
\dot{\psi} \\
\end{bmatrix}
=
\begin{bmatrix}
1 &amp; \sin\phi\tan\theta &amp; \cos\phi\tan\theta \\
0 &amp; \cos\phi &amp; -\sin\phi \\
0 &amp; \sin\phi/\cos\theta &amp; \cos\phi/\cos\theta \\
\end{bmatrix}
\begin{bmatrix}
p \\
q \\
r \\
\end{bmatrix}\]</div><p>Now we need to resolve the dynamics. We start with the linear velocity: <span>$\vec{V_b} = [u, v, w]^T$</span>.  We can apply Newton&#39;s second law to the motion of the vehicle as follows:</p><div>\[\vec{F} = m \frac{d \vec{V}}{dt_i}\]</div><p>where the derivative is in an inertial frame.  Newton&#39;s laws are only applicable in an inertial frame of reference. If a reference frame <span>$b$</span> is rotating relative to an inertial frame <span>$i$</span> then the time derivative of any vector <span>$\vec{v}$</span> can be described as:</p><div>\[\left.\frac{d \vec{v}}{dt}\right|_i + \left.\frac{d \vec{v}}{dt}\right|_b + \vec{\omega}_{b/i} \times \vec{v}\]</div><p>where <span>$\vec{\omega}_{b/i}$</span> is the rotation of reference frame <span>$b$</span> relative to <span>$i$</span>.</p><p>We transform Newton&#39;s law to the body frame using the relationship from above.</p><div>\[\vec{F} = m \left( \frac{d\vec{V}}{dt_b} + \vec{\omega}_{b/i} \times \vec{V} \right)\]</div><p>We can evaluate these forces/velocities in any frame, but the most convenient will be the body frame:</p><div>\[\vec{F_b} = m \left( \frac{d\vec{V_b}}{dt_b} + \vec{\omega_b} \times \vec{V_b} \right)\]</div><p>Since the end goal is an ODE and so we solve for <span>$dV_b/dt_b$</span>:</p><div>\[\frac{d \vec{V_b}}{dt_b} = \frac{\vec{F_b}}{m} - \vec{\omega_b} \times  \vec{V_b}\]</div><p>where <span>$\vec{\omega_b} = [p, q, r]^T$</span>.</p><p>We follow a similar procedure for the rotational motion.</p><div>\[\begin{aligned}
\vec{M} &amp;= \frac{d\vec{H}}{dt_i}\\
 &amp;= \frac{d\vec{H}}{dt_b} + \vec{\omega}_{b/i} \times \vec{H} \\
 &amp;= \frac{d\vec{H_b}}{dt_b} + \vec{\omega_b} \times \vec{H_b} \\
\end{aligned}\]</div><p>The angular momentum is given by:</p><div>\[\begin{aligned}
\vec{H} &amp;= I \vec{\omega}\\
\vec{H_b} &amp;= I_b \vec{\omega_b}
\end{aligned}\]</div><p>where <span>$I_b$</span> is the moment of inertia tensor defined in the body axis.</p><div>\[I = 
\begin{bmatrix}
I_{xx} &amp; -I_{xy} &amp; -I_{xz} \\
-I_{xy} &amp; I_{yy} &amp; -I_{yz} \\
-I_{zx} &amp; -I_{zy} &amp; I_{zz} 
\end{bmatrix}\]</div><p>(note the minus signs on the off-diagonal components).  The diagonal components of the tensor are given by:</p><div>\[I_{xx} = \int (y^2 + z^2) dm\]</div><p>and the off-diagonal components are given by:</p><div>\[I_{xy} = \int xy dm\]</div><p>Most aircraft are symmetric about the y-axis and so typically <span>$I_{xy} = I_{yz} = 0$</span>.</p><p>We now plug the definition of the angular moment back into Newton&#39;s law.  Unless, the aircraft is able to morph, the inertia tensor is constant in the body frame and so the equation becomes:</p><div>\[\vec{M_b} = I_b \frac{d\vec{\omega_b}}{dt_b} + \vec{\omega_b} \times I_b \vec{\omega_b}\]</div><p>We solve for the derivative of the angular velocity:</p><div>\[\frac{d\vec{\omega_b}}{dt_b} = I_b^{-1} \left(\vec{M_b} - \vec{\omega_b} \times I_b \vec{\omega_b} \right)\]</div><p>Note, that although a matrix inverse was written, in numerical implementation a linear solve would be used rather than an explicit inversion.</p><h2><a class="nav-anchor" id="Forces/Moments-1" href="#Forces/Moments-1">Forces/Moments</a></h2><p>The primary forces and moments on the aircraft are from aerodynamics, propulsion, and gravity.  The former two are outside the scope of the dynamics module, although simple default implementations will be discussed.  The latter is straightforward.  Gravity always acts about the vehicle&#39;s center of mass <a href="#footnote-3">[3]</a>, and so cannot create any moments on the vehicle.  Based on our above derivation we need forces/moments to be specified in the body frame.</p><h3><a class="nav-anchor" id="Gravity-1" href="#Gravity-1">Gravity</a></h3><p>In the inertial frame gravity is in the positive z direction (recall that positive z is down).  Thus we just need to apply a rotation to the body frame:</p><div>\[F_g = R_{i \rightarrow b}
\begin{bmatrix}
0 \\
0 \\
mg \\
\end{bmatrix}\]</div><p>For our choice of Euler angles we can write this out explicitly as:</p><div>\[\begin{bmatrix}
-mg \sin\theta \\
mg \sin\phi\cos\theta \\
mg \cos\phi\cos\theta \\
\end{bmatrix}\]</div><h3><a class="nav-anchor" id="Aerodynamics-(General)-1" href="#Aerodynamics-(General)-1">Aerodynamics (General)</a></h3><p>Aerodynamic behavior is relative to the local freestream <span>$V_\infty$</span>.  The local freestream, is the negative of what is referred to as true airspeed, and the true airspeed is ground speed minus wind speed.  </p><div>\[\vec{V_\infty} = -\vec{V_{a}} = -(\vec{V_g} - \vec{V_w})\]</div><p>Ground speed, in the body frame is <span>$\vec{V_g} = \vec{V_b} = [u, v, w]^T$</span>.  For convenience, we allow the user to define a portion of the wind in the inertial frame and a portion in the body frame if desired.  The former would typically be steady-state winds, and the latter would typically represent gusts.  While an aerodynamicist uses the freestream, we will use dynamics convention and use the vehicle&#39;s airspeed instead (just a change in sign):</p><div>\[\vec{V_a}_b =  \vec{V_{b}} - \left( R_{i \rightarrow b} \vec{V_{wi}} + \vec{V_{wb}}\right)\]</div><p>Aerodynamics requires an additional coordinate system: the wind frame.  Actually, we need one more intermediate frame, the stability frame, which occurs between the body frame and the wind frame.  Again, we adopt dynamics convention (aerodynamics convention uses the opposite sign for the x and z axes).  These two coordinate systems are depicted below.  The top figure shows the stability frame.  It is rotated about the body y-axis axis by the angle of attack <span>$\alpha$</span>.  The bottom two figures depict the wind axis.  It is rotated about the stability z-axis by the sideslip angle <span>$\beta$</span>.  The coordinate transformation from wind to body axes (the direction we will usually go) is thus:</p><div>\[\begin{bmatrix}
\cos\alpha \cos\beta &amp; -\cos\alpha \sin\beta &amp; -\sin\alpha \\
\sin\beta &amp; \cos\beta &amp; 0 \\
\sin\alpha \cos\beta &amp; -\sin\alpha \sin\beta &amp; \cos\alpha \\
\end{bmatrix}\]</div><p>(and the transformation from body to wind axes is the transpose of this).</p><p><img src="../alphabeta.png" alt="Stability and wind axes"/></p><p>The airspeed vector in the wind axes is:</p><div>\[\vec{V_a}_w = (V_a, 0, 0)\]</div><p>From the definitions, either using the figure, or the coordinate transformation we can see that the airspeed vector in the body frame is then:</p><div>\[\vec{V_a}_b = V_a 
\begin{bmatrix}
\cos\alpha\cos\beta\\
\sin\beta \\
\sin\alpha\cos\beta
\end{bmatrix}\]</div><p>We see that the airspeed is the magnitude of this vector</p><div>\[V_a = ||\vec{V_a}_b||_2\]</div><p>If we call the components of the airspeed in the body frame as follows: <span>$\vec{V_a}_b = [u_a, v_a, w_w]^T$</span> then the angle of attack and sideslip angles are given by:</p><div>\[\alpha = \tan^{-1}\left(\frac{w_a}{u_a}\right)\]</div><div>\[\beta = \sin^{-1}\left(\frac{v_a}{V_a}\right)\]</div><p>These calculations may also be visualized from the figure below.</p><p><img src="../alphabeta2.png" alt="angle of attack and sideslip"/></p><p>Because we have used dynamic conventions, we need to be careful to translate the aerodynamic forces properly.  Lift, side force, and drag, would be defined with the following signs using the dynamics wind frame:</p><div>\[{F_{aero}}_w = [-D, Y, -L]\]</div><p>Notice that drag and lift are defined in opposite directions from the dynamics positive coordinate directions.</p><p>Aerodynamic moments are typically also defined in the stability or wind axes, and so would be defined as follows using the dynamics wind frame.</p><div>\[{M_{aero}}_w = [\mathcal{L}, M, N]\]</div><p>where the moments are rolling, pitching, and yaw respectively. Note that the rolling moment and yawing moment do not require any sign changes as the aerodynamic directions follow the same as used in dynamics.</p><h3><a class="nav-anchor" id="Aerodynamics-(a-specific-implementation)-1" href="#Aerodynamics-(a-specific-implementation)-1">Aerodynamics (a specific implementation)</a></h3><p>Everything up to this point defines the 6DOF simulator.  The aerodynamics, propulsion, and other forces/moments if applicable, are specific to the model choice.  As a simple default a conventional ``linear&#39;&#39; aerodynamics model is included.  This model we use is actually not strictly linear, particuarly in the case of drag, which is fundamentally nonlinear.  Arguably, that addition is negliglbe as aircraft drag typically plays a negligible role in its dynamic behavior.</p><p>We define the aerodynamic forces and moments using stability derivatives and control derivatives. The control deflections include <span>$[\delta f, \delta e, \delta r, \delta a]$</span> for flaps, elevator, rudder, and aileron respectively.</p><p>For lift:</p><div>\[C_L = {C_L}_0 + \frac{d C_L}{d\alpha}\alpha + \frac{d C_L}{dq} \frac{q c}{2 V_a} + \frac{d C_L}{dM}M + \frac{d C_L}{d \delta f}\delta f + \frac{d C_L}{d \delta e}\delta e\]</div><p>where <span>$Mach$</span> is the Mach number.  A maximum and minimum <span>$C_L$</span> is also enforced (a very crude approximation of stall) via <span>${C_L}_{max}$</span> and <span>${C_L}_{min}$</span>.</p><p>Drag is a combination of parasitic, induced, and compressibility drag.  The parasitic drag coefficient is proportional to a skin friction coefficient <span>${C_D}_f$</span>, which is Reynolds number dependent.  For laminar flow (Blasisus solution):</p><div>\[{C_D}_f \propto \frac{1}{\sqrt{Re}}\]</div><p>For turbulent flow no such analytic solution exists, various empirical relationships exists such as the Schlichting formula:</p><div>\[{C_D}_f \propto \frac{1}{Re^{0.2}}\]</div><p>We assume that the kinematic viscosity does not change appreciably throughout the trajectory and so the Reynolds number scaling only changes with the flight speed.  We can then define the parasitic drag as:</p><div>\[{C_D}_p = {C_D}_0 \left(\frac{V_a}{V_{ref}}\right)^{-k}\]</div><p>where <span>${C_D}_0$</span> is the zero-lift drag coefficient, and the second term is the Reynolds number correction based on the reference speed <span>$V_{ref}$</span> (corresponding to the Reynolds number at which <span>${C_D}_0$</span> was computed at, and an exponent for the skin friction coefficnet: <span>$k = 0.5$</span> for laminar and <span>$k = 0.2$</span> for turbulent.</p><p>The induced drag is given by its standard definition:</p><div>\[{C_D}_i = \frac{C_L^2}{\pi AR e}\]</div><p>where <span>$e$</span> is Oswald&#39;s efficiency factor, and the aspect ratio uses the reference dimensions of the aircraft (span and area).</p><p>Compressibility drag uses an simple empirical quartic drag rise after the crest-critical Mach number:</p><div>\[{C_D}_c = 20(M - M_{cc})^4\]</div><p>The parasitic drag is the sum of these three components plus that from control deflections.  An absolute value must be used for the control parts as deflections in either direction would increase drag.</p><div>\[{C_D} = {C_D}_p + {C_D}_i + {C_D}_c + \left|\frac{d C_D}{d \delta f}\delta f\right| + \left|\frac{d C_D}{d \delta e}\delta e\right| + \left|\frac{d C_D}{d \delta a}\delta a\right| + \left|\frac{d C_D}{d \delta r}\delta r\right|\]</div><h3><a class="nav-anchor" id="Propulsion-1" href="#Propulsion-1">Propulsion</a></h3><p>TODO</p><div class="footnote" id="footnote-1"><a href="#footnote-1"><strong>[1]</strong></a><p>The earth is not, strictly speaking, an inertial frame since it is rotating and so objects on the surface are accelerating.  However, for our applications including the inertial effect is negligible.</p></div><div class="footnote" id="footnote-2"><a href="#footnote-2"><strong>[2]</strong></a><p>Small Unmanned Aircraft: Theory and Practice, Randal W. Beard and Timothy W. McLain, Princeton University Press, 2012.</p></div><div class="footnote" id="footnote-3"><a href="#footnote-3"><strong>[3]</strong></a><p>Actually it acts about the center of gravity, but in practice these are the same.  The only time we&#39;d see a noticeable difference is if the vehicle was extremely large, or if this was a satellite then the very small gravitational moments might be important in its dynamics.</p></div><footer><hr/><a class="previous" href="../guide/"><span class="direction">Previous</span><span class="title">Guide</span></a></footer></article></body></html>
